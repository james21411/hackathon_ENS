<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathQuest : L'Aventure des Fonctions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .title {
            font-size: 3em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .progress-container {
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            padding: 10px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc88);
            border-radius: 15px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .level-indicator {
            text-align: center;
            color: white;
            font-weight: bold;
            margin-top: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .theory-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .interactive-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .canvas-container {
            width: 100%;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            position: relative;
            margin: 20px 0;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            border-color: #4facfe;
            outline: none;
        }

        .level-card {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #333;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .level-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .level-description {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .objectives {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .objectives h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .objectives ul {
            list-style: none;
            padding-left: 0;
        }

        .objectives li {
            padding: 5px 0;
            position: relative;
            padding-left: 25px;
        }

        .objectives li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }

        .problem-section {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .problem-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #d35400;
            margin-bottom: 15px;
        }

        .score-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .achievement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 2000;
            transition: transform 0.5s ease;
        }

        .achievement.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .theory-content {
            line-height: 1.8;
            color: #2c3e50;
        }

        .formula {
            background: #f8f9fa;
            border-left: 4px solid #4facfe;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }

        .example {
            background: #e8f5e8;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #27ae60;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 class="title">üéØ MathQuest</h1>
            <p class="subtitle">L'Aventure Interactive des Fonctions Math√©matiques</p>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="level-indicator">
                    <span id="currentLevel">Niveau 1</span> - <span id="currentTitle">Introduction aux Fonctions</span>
                </div>
            </div>
        </div>

        <div class="score-display">
            <div>üèÜ Score: <span id="score">0</span></div>
            <div>‚≠ê √âtoiles: <span id="stars">0</span>/30</div>
        </div>

        <div class="main-content">
            <div class="theory-panel">
                <div id="theoryContent">
                    <div class="level-card">
                        <div class="level-title">
                            üìö Niveau 1: Introduction aux Fonctions
                        </div>
                        <div class="theory-content">
                            <p>Une fonction est une relation math√©matique qui associe √† chaque √©l√©ment d'un ensemble de d√©part (domaine) un unique √©l√©ment d'un ensemble d'arriv√©e (codomaine).</p>
                            
                            <div class="formula">
                                f: ‚Ñù ‚Üí ‚Ñù<br>
                                x ‚Ü¶ f(x) = ax + b
                            </div>
                            
                            <div class="example">
                                <strong>Exemple:</strong> f(x) = 2x + 1<br>
                                ‚Ä¢ f(0) = 1<br>
                                ‚Ä¢ f(1) = 3<br>
                                ‚Ä¢ f(-1) = -1
                            </div>
                        </div>
                        
                        <div class="objectives">
                            <h4>üéØ Objectifs p√©dagogiques:</h4>
                            <ul>
                                <li>Comprendre la notion de fonction</li>
                                <li>Savoir calculer l'image d'un nombre</li>
                                <li>Tracer une fonction lin√©aire</li>
                                <li>Identifier le domaine et l'image</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="interactive-panel">
                <h3>üéÆ Zone Interactive</h3>
                
                <div class="canvas-container">
                    <canvas id="functionCanvas" width="500" height="400"></canvas>
                </div>
                
                <div class="input-group">
                    <label for="functionInput">Entrez votre fonction f(x) =</label>
                    <input type="text" id="functionInput" placeholder="Ex: 2*x + 1, x^2, sin(x)" value="2*x + 1">
                </div>
                
                <div class="controls">
                    <button class="btn" onclick="plotFunction()">üìà Tracer</button>
                    <button class="btn btn-success" onclick="showDerivative()">üìä D√©riv√©e</button>
                    <button class="btn btn-warning" onclick="clearCanvas()">üóëÔ∏è Effacer</button>
                    <button class="btn" onclick="nextLevel()" id="nextLevelBtn" style="display: none;">‚û°Ô∏è Niveau Suivant</button>
                </div>
                
                <div id="exerciseSection">
                    <div class="problem-section">
                        <div class="problem-title">üéØ Exercice du Niveau 1</div>
                        <p><strong>Probl√®me:</strong> Une entreprise vend des produits. Le co√ªt de production est donn√© par C(x) = 5x + 100, o√π x est le nombre d'unit√©s produites.</p>
                        <p><strong>Question:</strong> Quel est le co√ªt pour produire 20 unit√©s ?</p>
                        
                        <div class="input-group">
                            <label>Votre r√©ponse:</label>
                            <input type="number" id="answer1" placeholder="Entrez votre r√©ponse">
                        </div>
                        
                        <button class="btn btn-success" onclick="checkAnswer(1, 200)">V√©rifier</button>
                        <div id="feedback1" style="margin-top: 10px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="achievement" id="achievement">
        <h2>üéâ F√©licitations !</h2>
        <p id="achievementText">Vous avez r√©ussi le niveau !</p>
    </div>

    <script>
        // Variables globales du jeu
        let currentLevelIndex = 0;
        let totalScore = 0;
        let totalStars = 0;
        let canvas, ctx;

        // Configuration des niveaux
        const levels = [
            {
                title: "Introduction aux Fonctions",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 1: Introduction aux Fonctions</div>
                        <div class="theory-content">
                            <p>Une fonction est une relation math√©matique qui associe √† chaque √©l√©ment d'un ensemble de d√©part un unique √©l√©ment d'un ensemble d'arriv√©e.</p>
                            <div class="formula">f: ‚Ñù ‚Üí ‚Ñù<br>x ‚Ü¶ f(x) = ax + b</div>
                            <div class="example"><strong>Exemple:</strong> f(x) = 2x + 1<br>‚Ä¢ f(0) = 1<br>‚Ä¢ f(1) = 3</div>
                        </div>
                        <div class="objectives">
                            <h4>üéØ Objectifs:</h4>
                            <ul><li>Comprendre la notion de fonction</li><li>Calculer l'image d'un nombre</li></ul>
                        </div>
                    </div>
                `,
                problem: {
                    text: "Une entreprise a un co√ªt de production C(x) = 5x + 100. Quel est le co√ªt pour 20 unit√©s ?",
                    answer: 200
                }
            },
            {
                title: "Fonctions Quadratiques",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 2: Fonctions Quadratiques</div>
                        <div class="theory-content">
                            <p>Une fonction quadratique a la forme f(x) = ax¬≤ + bx + c o√π a ‚â† 0.</p>
                            <div class="formula">f(x) = ax¬≤ + bx + c<br>Sommet: x = -b/(2a)</div>
                            <div class="example"><strong>Exemple:</strong> f(x) = x¬≤ - 4x + 3<br>Sommet en x = 2</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "Pour f(x) = x¬≤ - 6x + 8, trouvez l'abscisse du sommet.",
                    answer: 3
                }
            },
            {
                title: "D√©riv√©es et Tangentes",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 3: D√©riv√©es</div>
                        <div class="theory-content">
                            <p>La d√©riv√©e d'une fonction repr√©sente le taux de variation instantan√©.</p>
                            <div class="formula">f'(x) = lim[h‚Üí0] [f(x+h) - f(x)]/h</div>
                            <div class="example"><strong>R√®gles:</strong><br>‚Ä¢ (x^n)' = nx^(n-1)<br>‚Ä¢ (ax+b)' = a</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "Quelle est la d√©riv√©e de f(x) = 3x¬≤ + 2x - 1 ?",
                    answer: "6x + 2"
                }
            },
            {
                title: "Asymptotes",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 4: Asymptotes</div>
                        <div class="theory-content">
                            <p>Les asymptotes sont des droites dont la courbe se rapproche ind√©finiment.</p>
                            <div class="formula">Asymptote verticale: x = a si lim[x‚Üía] f(x) = ¬±‚àû<br>Asymptote horizontale: y = L si lim[x‚Üí¬±‚àû] f(x) = L</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "Pour f(x) = 1/(x-2), quelle est l'asymptote verticale ?",
                    answer: 2
                }
            },
            {
                title: "Fonctions Exponentielles",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 5: Fonctions Exponentielles</div>
                        <div class="theory-content">
                            <p>Les fonctions exponentielles ont la forme f(x) = a^x o√π a > 0 et a ‚â† 1.</p>
                            <div class="formula">f(x) = e^x<br>f'(x) = e^x</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "La population d'une ville suit P(t) = 10000¬∑e^(0.02t). Apr√®s 10 ans ?",
                    answer: 12214
                }
            },
            {
                title: "Fonctions Logarithmiques",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 6: Fonctions Logarithmiques</div>
                        <div class="theory-content">
                            <p>Le logarithme est la fonction r√©ciproque de l'exponentielle.</p>
                            <div class="formula">ln(e^x) = x<br>e^(ln(x)) = x</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "R√©solvez: ln(x) = 2",
                    answer: 7.39
                }
            },
            {
                title: "Fonctions Trigonom√©triques",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 7: Fonctions Trigonom√©triques</div>
                        <div class="theory-content">
                            <p>Les fonctions sin, cos et tan sont p√©riodiques.</p>
                            <div class="formula">sin¬≤(x) + cos¬≤(x) = 1<br>P√©riode: 2œÄ</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "Quelle est la p√©riode de f(x) = sin(2x) ?",
                    answer: 3.14
                }
            },
            {
                title: "Fonctions R√©ciproques",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 8: Fonctions R√©ciproques</div>
                        <div class="theory-content">
                            <p>Une fonction r√©ciproque f‚Åª¬π v√©rifie f(f‚Åª¬π(x)) = x.</p>
                            <div class="formula">Si y = f(x), alors x = f‚Åª¬π(y)</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "Si f(x) = 2x + 3, que vaut f‚Åª¬π(7) ?",
                    answer: 2
                }
            },
            {
                title: "Optimisation",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üìö Niveau 9: Optimisation</div>
                        <div class="theory-content">
                            <p>L'optimisation utilise les d√©riv√©es pour trouver les extremums.</p>
                            <div class="formula">f'(x) = 0 pour les points critiques<br>f''(x) d√©termine max/min</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "Maximisez f(x) = -x¬≤ + 4x + 1. Quelle est la valeur maximale ?",
                    answer: 5
                }
            },
            {
                title: "Projet Final",
                theory: `
                    <div class="level-card">
                        <div class="level-title">üèÜ Niveau 10: Projet Final</div>
                        <div class="theory-content">
                            <p>F√©licitations ! Vous ma√Ætrisez les fonctions math√©matiques !</p>
                            <div class="example">Vous pouvez maintenant analyser toute fonction complexe !</div>
                        </div>
                    </div>
                `,
                problem: {
                    text: "Un projectile suit y = -5x¬≤ + 20x + 10. √Ä quelle distance maximale ?",
                    answer: 30
                }
            }
        ];

        // Initialisation du jeu
        function initGame() {
            canvas = document.getElementById('functionCanvas');
            ctx = canvas.getContext('2d');
            
            // Configuration du canvas
            canvas.width = 500;
            canvas.height = 400;
            
            drawGrid();
            updateLevel();
        }

        // Dessiner la grille
        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            
            // Lignes verticales
            for (let x = 0; x <= canvas.width; x += 25) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // Lignes horizontales
            for (let y = 0; y <= canvas.height; y += 25) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Axes principaux
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // Axe X
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
            
            // Axe Y
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
        }

        // Tracer une fonction
        function plotFunction() {
            const functionInput = document.getElementById('functionInput').value;
            drawGrid();
            
            ctx.strokeStyle = '#4facfe';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let firstPoint = true;
            const scale = 25;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            for (let x = -10; x <= 10; x += 0.1) {
                try {
                    let y = evaluateFunction(functionInput, x);
                    
                    if (!isNaN(y) && isFinite(y)) {
                        const canvasX = centerX + x * scale;
                        const canvasY = centerY - y * scale;
                        
                        if (canvasY >= 0 && canvasY <= canvas.height) {
                            if (firstPoint) {
                                ctx.moveTo(canvasX, canvasY);
                                firstPoint = false;
                            } else {
                                ctx.lineTo(canvasX, canvasY);
                            }
                        }
                    }
                } catch (e) {
                    // Ignorer les erreurs de calcul
                }
            }
            
            ctx.stroke();
        }

        // √âvaluer une fonction
        function evaluateFunction(expr, x) {
            // Remplacer x par la valeur
            let func = expr.replace(/x/g, `(${x})`);
            
            // Remplacer les op√©rations math√©matiques
            func = func.replace(/\^/g, '**');
            func = func.replace(/sin/g, 'Math.sin');
            func = func.replace(/cos/g, 'Math.cos');
            func = func.replace(/tan/g, 'Math.tan');
            func = func.replace(/ln/g, 'Math.log');
            func = func.replace(/log/g, 'Math.log10');
            func = func.replace(/sqrt/g, 'Math.sqrt');
            func = func.replace(/pi/g, 'Math.PI');
            func = func.replace(/e/g, 'Math.E');
            
            return eval(func);
        }

        // Afficher la d√©riv√©e
        function showDerivative() {
            const functionInput = document.getElementById('functionInput').value;
            
            // Calcul num√©rique de la d√©riv√©e
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const scale = 25;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const h = 0.001;
            
            let firstPoint = true;
            
            for (let x = -10; x <= 10; x += 0.1) {
                try {
                    const y1 = evaluateFunction(functionInput, x + h);
                    const y2 = evaluateFunction(functionInput, x - h);
                    const derivative = (y1 - y2) / (2 * h);
                    
                    if (!isNaN(derivative) && isFinite(derivative)) {
                        const canvasX = centerX + x * scale;
                        const canvasY = centerY - derivative * scale;
                        
                        if (canvasY >= 0 && canvasY <= canvas.height) {
                            if (firstPoint) {
                                ctx.moveTo(canvasX, canvasY);
                                firstPoint = false;
                            } else {
                                ctx.lineTo(canvasX, canvasY);
                            }
                        }
                    }
                } catch (e) {
                    // Ignorer les erreurs
                }
            }
            
            ctx.stroke();
        }

        // Effacer le canvas
        function clearCanvas() {
            drawGrid();
        }

        // V√©rifier la r√©ponse
        function checkAnswer(levelNum, correctAnswer) {
            const userAnswer = document.getElementById(`answer${levelNum}`).value;
            const feedback = document.getElementById(`feedback${levelNum}`);
            
            if (Math.abs(parseFloat(userAnswer) - correctAnswer) < 0.1) {
                feedback.innerHTML = '<span style="color: green; font-weight: bold;">‚úÖ Correct ! Excellent travail !</span>';
                totalScore += 100;
                totalStars += 3;
                updateScore();
                showAchievement("Niveau r√©ussi !");
                document.getElementById('nextLevelBtn').style.display = 'inline-block';
            } else {
                feedback.innerHTML = '<span style="color: red; font-weight: bold;">‚ùå Incorrect. R√©essayez !</span>';
                totalScore += 10;
                totalStars += 1;
                updateScore();
            }
        }

        // Afficher un succ√®s
        function showAchievement(text) {
            const achievement = document.getElementById('achievement');
            document.getElementById('achievementText').textContent = text;
            achievement.classList.add('show');
            
            setTimeout(() => {
                achievement.classList.remove('show');
            }, 3000);
        }

        // Mettre √† jour le score
        function updateScore() {
            document.getElementById('score').textContent = totalScore;
            document.getElementById('stars').textContent = totalStars;
        }

        // Passer au niveau suivant
        function nextLevel() {
            if (currentLevelIndex < levels.length - 1) {
                currentLevelIndex++;
                updateLevel();
                showAchievement(`Niveau ${currentLevelIndex + 1} d√©bloqu√© !`);
                document.getElementById('nextLevelBtn').style.display = 'none';
            } else {
                showAchievement("üéâ F√©licitations ! Vous avez termin√© tous les niveaux !");
            }
        }

        // Mettre √† jour le niveau
        function updateLevel() {
            const level = levels[currentLevelIndex];
            
            // Mettre √† jour l'affichage du niveau
            document.getElementById('currentLevel').textContent = `Niveau ${currentLevelIndex + 1}`;
            document.getElementById('currentTitle').textContent = level.title;
            
            // Mettre √† jour la barre de progression
            const progress = ((currentLevelIndex + 1) / levels.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Mettre √† jour le contenu th√©orique
            document.getElementById('theoryContent').innerHTML = level.theory;
            
            // Mettre √† jour l'exercice
            updateExercise();
            
            // Suggestions de fonctions par niveau
            const suggestions = [
                "2*x + 1",      // Niveau 1: Lin√©aire
                "x*x - 4*x + 3", // Niveau 2: Quadratique
                "x*x*x - 3*x",   // Niveau 3: Cubique
                "1/(x-2)",       // Niveau 4: Rationnelle
                "Math.exp(x)",   // Niveau 5: Exponentielle
                "Math.log(x)",   // Niveau 6: Logarithme
                "Math.sin(x)",   // Niveau 7: Trigonom√©trique
                "Math.sqrt(x)",  // Niveau 8: Racine
                "-x*x + 4*x",    // Niveau 9: Parabole
                "-5*x*x + 20*x + 10" // Niveau 10: Projectile
            ];
            
            document.getElementById('functionInput').value = suggestions[currentLevelIndex] || "x";
            plotFunction();
        }

        // Mettre √† jour l'exercice
        function updateExercise() {
            const level = levels[currentLevelIndex];
            const exerciseSection = document.getElementById('exerciseSection');
            
            exerciseSection.innerHTML = `
                <div class="problem-section">
                    <div class="problem-title">üéØ Exercice du Niveau ${currentLevelIndex + 1}</div>
                    <p><strong>Probl√®me:</strong> ${level.problem.text}</p>
                    
                    <div class="input-group">
                        <label>Votre r√©ponse:</label>
                        <input type="number" id="answer${currentLevelIndex + 1}" placeholder="Entrez votre r√©ponse" step="0.01">
                    </div>
                    
                    <button class="btn btn-success" onclick="checkAnswer(${currentLevelIndex + 1}, ${level.problem.answer})">V√©rifier</button>
                    <div id="feedback${currentLevelIndex + 1}" style="margin-top: 10px;"></div>
                    
                    <div class="input-group" style="margin-top: 20px;">
                        <label>üí° Conseil:</label>
                        <div id="hint${currentLevelIndex + 1}" style="background: #f0f8ff; padding: 10px; border-radius: 5px; margin-top: 5px;">
                            ${getHint(currentLevelIndex + 1)}
                        </div>
                    </div>
                </div>
            `;
        }

        // Obtenir un conseil pour chaque niveau
        function getHint(level) {
            const hints = [
                "Remplacez x par 20 dans la fonction C(x) = 5x + 100",
                "Utilisez la formule x = -b/(2a) pour trouver l'abscisse du sommet",
                "D√©rivez terme par terme : (x¬≤)' = 2x, (x)' = 1, (constante)' = 0",
                "L'asymptote verticale se trouve o√π le d√©nominateur s'annule",
                "Utilisez la calculatrice pour e^(0.02√ó10) ‚âà 1.2214",
                "Si ln(x) = 2, alors x = e¬≤ ‚âà 7.39",
                "La p√©riode de sin(2x) est 2œÄ/2 = œÄ ‚âà 3.14",
                "R√©solvez y = 2x + 3 pour x quand y = 7",
                "Trouvez o√π f'(x) = 0, puis calculez f(x) en ce point",
                "Trouvez le sommet de cette parabole pour la hauteur maximale"
            ];
            return hints[level - 1] || "Analysez bien la fonction !";
        }

        // Fonctions avanc√©es pour l'interactivit√©
        function analyzeFunction() {
            const functionInput = document.getElementById('functionInput').value;
            const analysisDiv = document.getElementById('analysisResults') || createAnalysisDiv();
            
            let analysis = "<h4>üìä Analyse de la fonction</h4>";
            
            // D√©terminer le type de fonction
            if (functionInput.includes('x*x') || functionInput.includes('x**2')) {
                analysis += "<p><strong>Type:</strong> Fonction quadratique</p>";
            } else if (functionInput.includes('Math.sin') || functionInput.includes('Math.cos')) {
                analysis += "<p><strong>Type:</strong> Fonction trigonom√©trique</p>";
            } else if (functionInput.includes('Math.exp')) {
                analysis += "<p><strong>Type:</strong> Fonction exponentielle</p>";
            } else if (functionInput.includes('Math.log')) {
                analysis += "<p><strong>Type:</strong> Fonction logarithmique</p>";
            } else if (functionInput.includes('/')) {
                analysis += "<p><strong>Type:</strong> Fonction rationnelle</p>";
            } else {
                analysis += "<p><strong>Type:</strong> Fonction polynomiale</p>";
            }
            
            // Calculer quelques valeurs
            analysis += "<p><strong>Valeurs remarquables:</strong></p>";
            analysis += "<ul>";
            try {
                analysis += `<li>f(0) = ${evaluateFunction(functionInput, 0).toFixed(2)}</li>`;
                analysis += `<li>f(1) = ${evaluateFunction(functionInput, 1).toFixed(2)}</li>`;
                analysis += `<li>f(-1) = ${evaluateFunction(functionInput, -1).toFixed(2)}</li>`;
            } catch (e) {
                analysis += "<li>Erreur dans l'√©valuation</li>";
            }
            analysis += "</ul>";
            
            analysisDiv.innerHTML = analysis;
        }

        function createAnalysisDiv() {
            const analysisDiv = document.createElement('div');
            analysisDiv.id = 'analysisResults';
            analysisDiv.style.cssText = `
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 10px;
                padding: 15px;
                margin-top: 20px;
            `;
            document.querySelector('.interactive-panel').appendChild(analysisDiv);
            return analysisDiv;
        }

        // Ajouter des points interactifs
        function addInteractivePoints() {
            canvas.addEventListener('click', function(event) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                // Convertir les coordonn√©es canvas en coordonn√©es math√©matiques
                const mathX = (x - canvas.width / 2) / 25;
                const mathY = (canvas.height / 2 - y) / 25;
                
                // Afficher les coordonn√©es
                showCoordinates(mathX, mathY, x, y);
            });
        }

        function showCoordinates(mathX, mathY, canvasX, canvasY) {
            // Effacer les anciens points
            const oldPoints = canvas.querySelectorAll('.coordinate-point');
            oldPoints.forEach(point => point.remove());
            
            // Cr√©er un nouveau point
            const point = document.createElement('div');
            point.className = 'coordinate-point';
            point.style.cssText = `
                position: absolute;
                left: ${canvasX - 5}px;
                top: ${canvasY - 5}px;
                width: 10px;
                height: 10px;
                background: red;
                border-radius: 50%;
                pointer-events: none;
            `;
            
            canvas.parentElement.appendChild(point);
            
            // Afficher les coordonn√©es
            setTimeout(() => {
                alert(`Coordonn√©es: (${mathX.toFixed(2)}, ${mathY.toFixed(2)})`);
            }, 100);
        }

        // Fonctions de gamification avanc√©es
        function unlockAchievement(achievementType) {
            const achievements = {
                'first_plot': 'üé® Premier Trac√©',
                'derivative_master': 'üìà Ma√Ætre des D√©riv√©es',
                'function_explorer': 'üîç Explorateur de Fonctions',
                'problem_solver': 'üß© R√©solveur de Probl√®mes',
                'math_genius': 'üß† G√©nie Math√©matique'
            };
            
            if (achievements[achievementType]) {
                showAchievement(`Succ√®s d√©bloqu√©: ${achievements[achievementType]}`);
            }
        }

        // Syst√®me de sauvegarde des progr√®s
        function saveProgress() {
            const progress = {
                currentLevel: currentLevelIndex,
                score: totalScore,
                stars: totalStars,
                completedLevels: currentLevelIndex
            };
            
            // Simulation de sauvegarde (en m√©moire)
            window.gameProgress = progress;
        }

        function loadProgress() {
            if (window.gameProgress) {
                const progress = window.gameProgress;
                currentLevelIndex = progress.currentLevel;
                totalScore = progress.score;
                totalStars = progress.stars;
                updateScore();
                updateLevel();
            }
        }

        // Mode libre pour exp√©rimentation
        function toggleFreeMode() {
            const freeMode = document.getElementById('freeMode') || createFreeMode();
            freeMode.style.display = freeMode.style.display === 'none' ? 'block' : 'none';
        }

        function createFreeMode() {
            const freeMode = document.createElement('div');
            freeMode.id = 'freeMode';
            freeMode.style.cssText = `
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 20px;
                border-radius: 15px;
                margin-top: 20px;
                display: none;
            `;
            
            freeMode.innerHTML = `
                <h3>üöÄ Mode Libre - Exp√©rimentation</h3>
                <p>Testez vos propres fonctions et explorez librement !</p>
                <div class="controls">
                    <button class="btn" onclick="plotFunction(); unlockAchievement('function_explorer')">üé® Tracer</button>
                    <button class="btn" onclick="analyzeFunction()">üìä Analyser</button>
                    <button class="btn" onclick="showDerivative()">üìà D√©riv√©e</button>
                    <button class="btn" onclick="findRoots()">üéØ Racines</button>
                </div>
            `;
            
            document.querySelector('.interactive-panel').appendChild(freeMode);
            return freeMode;
        }

        // Trouver les racines approximatives
        function findRoots() {
            const functionInput = document.getElementById('functionInput').value;
            const roots = [];
            
            // M√©thode de balayage simple
            for (let x = -10; x <= 10; x += 0.1) {
                try {
                    const y = evaluateFunction(functionInput, x);
                    if (Math.abs(y) < 0.1) {
                        roots.push(x.toFixed(2));
                    }
                } catch (e) {
                    // Ignorer les erreurs
                }
            }
            
            if (roots.length > 0) {
                alert(`Racines approximatives trouv√©es: ${roots.join(', ')}`);
            } else {
                alert('Aucune racine trouv√©e dans l\'intervalle [-10, 10]');
            }
        }

        // Initialisation compl√®te
        window.onload = function() {
            initGame();
            addInteractivePoints();
            
            // Ajouter le bouton mode libre
            const controls = document.querySelector('.controls');
            const freeModeBtn = document.createElement('button');
            freeModeBtn.className = 'btn';
            freeModeBtn.textContent = 'üöÄ Mode Libre';
            freeModeBtn.onclick = toggleFreeMode;
            controls.appendChild(freeModeBtn);
            
            // Ajouter le bouton d'analyse
            const analyzeBtn = document.createElement('button');
            analyzeBtn.className = 'btn';
            analyzeBtn.textContent = 'üìä Analyser';
            analyzeBtn.onclick = analyzeFunction;
            controls.appendChild(analyzeBtn);
            
            // Ajout d'effets sonores simul√©s
            window.playSound = function(type) {
                // Simulation d'effets sonores avec des alertes discr√®tes
                if (type === 'success') {
                    console.log('üéµ Son de succ√®s !');
                } else if (type === 'error') {
                    console.log('üîä Son d\'erreur !');
                }
            };
            
            // Message de bienvenue
            setTimeout(() => {
                showAchievement('Bienvenue dans MathQuest ! Commencez votre aventure !');
            }, 1000);
        };

        // Fonctions utilitaires suppl√©mentaires
        function resetGame() {
            if (confirm('√ätes-vous s√ªr de vouloir recommencer le jeu ?')) {
                currentLevelIndex = 0;
                totalScore = 0;
                totalStars = 0;
                updateScore();
                updateLevel();
                showAchievement('Jeu r√©initialis√© ! Bonne chance !');
            }
        }

        function showHelp() {
            const helpText = `
                üéÆ AIDE - MathQuest
                
                üìù Comment jouer:
                1. Lisez la th√©orie de chaque niveau
                2. Tracez des fonctions dans la zone interactive
                3. R√©solvez l'exercice pour passer au niveau suivant
                
                üéØ Objectifs:
                ‚Ä¢ Comprendre les concepts math√©matiques
                ‚Ä¢ Ma√Ætriser le trac√© de fonctions
                ‚Ä¢ R√©soudre des probl√®mes concrets
                
                üîß Fonctions disponibles:
                ‚Ä¢ +, -, *, / (op√©rations de base)
                ‚Ä¢ ^ ou ** (puissance)
                ‚Ä¢ Math.sin, Math.cos, Math.tan
                ‚Ä¢ Math.exp, Math.log, Math.sqrt
                ‚Ä¢ Math.PI, Math.E
                
                üí° Conseils:
                ‚Ä¢ Utilisez des parenth√®ses pour clarifier
                ‚Ä¢ Testez diff√©rentes fonctions
                ‚Ä¢ Observez les courbes et leurs propri√©t√©s
            `;
            
            alert(helpText);
        }

        // Ajouter les boutons d'aide et de reset
        window.addEventListener('load', function() {
            const header = document.querySelector('.header');
            const utilityButtons = document.createElement('div');
            utilityButtons.style.cssText = 'margin-top: 20px;';
            
            const helpBtn = document.createElement('button');
            helpBtn.className = 'btn';
            helpBtn.textContent = '‚ùì Aide';
            helpBtn.onclick = showHelp;
            
            const resetBtn = document.createElement('button');
            resetBtn.className = 'btn btn-warning';
            resetBtn.textContent = 'üîÑ Recommencer';
            resetBtn.onclick = resetGame;
            
            utilityButtons.appendChild(helpBtn);
            utilityButtons.appendChild(resetBtn);
            header.appendChild(utilityButtons);
        });